

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Customize your case: Spinning up the model &#8212; NEON Tutorial 2023</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/ProjectExamples/customizeCase_spinupExample';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/ncar_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/ncar_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorial FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/git/https%3A//github.com/NCAR/CTSM-Tutorial/tree/NEON_Tutorial_2023/NEON_Tutorial_2023?urlpath=tree/docs/notebooks/ProjectExamples/customizeCase_spinupExample.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NCAR/CTSM-Tutorial/tree/NEON_Tutorial_2023" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NCAR/CTSM-Tutorial/tree/NEON_Tutorial_2023/edit/NEON_Tutorial_2023/docs/notebooks/ProjectExamples/customizeCase_spinupExample.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NCAR/CTSM-Tutorial/tree/NEON_Tutorial_2023/issues/new?title=Issue%20on%20page%20%2Fnotebooks/ProjectExamples/customizeCase_spinupExample.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/ProjectExamples/customizeCase_spinupExample.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Customize your case: Spinning up the model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Customize your case: Spinning up the model</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-tutorial-you-will-use-run-neon-to">In this tutorial you will use run_neon to:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#background-on-spinup">Background on spinup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#look">LOOK</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">LOOK</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-get-started">Let’s get started!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-environment">Set up environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-ad-case">1. Create a new ad case.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-that-you-ve-run-a-control-case">1.1 Check that you’ve run a control case.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#navigate-to-your-source-code">1.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-experimental-clone">1.3 Create an experimental clone</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-your-case-namelist-changes">1.4 Customizing your case: Namelist changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#move-to-the-case-directory-for-your-experimental-clone">1.4.1 Move to the case directory for your experimental clone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customize-your-case">1.4.2 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#take-a-look">Take a look</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-build-and-submit-the-case">1.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#postad-simulations">2 postAD simulations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-sure-your-ad-case-is-finished">2.1 Be sure your AD case is finished.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-your-ad-run-is-completed-you-can-move-on">IF YOUR AD RUN IS COMPLETED, YOU CAN MOVE ON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-postad-experimental-case">2.3 Create a postAD experimental case</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.4 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transient-simulation">3 Transient simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-sure-your-postad-case-is-finished">3.1 Be sure your postAD case is finished.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-your-postad-run-is-completed-you-can-move-on">IF YOUR POSTAD RUN IS COMPLETED, YOU CAN MOVE ON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">3.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-transient-experimental-case">3.3 Create a transient experimental case</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">3.4 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-check">Double check</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="customize-your-case-spinning-up-the-model">
<h1>Customize your case: Spinning up the model<a class="headerlink" href="#customize-your-case-spinning-up-the-model" title="Permalink to this heading">#</a></h1>
<p><strong>This is an optional tutorial</strong> that provides some additional guidance for spinning up CTSM at NEON sites.</p>
<p>This tutorial assumes that you’ve already done a quick sensitivity test that your <a class="reference internal" href="customizeCase_parameterModifications.html"><span class="doc std std-doc">parameter modifications</span></a>, <a class="reference internal" href="customizeCase_modelFeatures.html"><span class="doc std std-doc">namelist changes</span></a>, or other code modifications changes answers is quick, transient simulations. It may be helpful to refer back to these tutorials if you have questions or want more information about creating an experimental case.</p>
<hr class="docutils" />
<section id="in-this-tutorial-you-will-use-run-neon-to">
<h2>In this tutorial you will use run_neon to:<a class="headerlink" href="#in-this-tutorial-you-will-use-run-neon-to" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Start an accelerated decomposition (ad) spinup from cold start.</p></li>
<li><p>Continue a postAD run,</p></li>
<li><p>Do a transient simulation</p></li>
</ol>
<hr class="docutils" />
<p>Spinup, or model initialization from a cold start, actually takes a little bit of time.  Let’s briefly cover what spinup means.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="background-on-spinup">
<h1>Background on spinup<a class="headerlink" href="#background-on-spinup" title="Permalink to this heading">#</a></h1>
<p>We make make steady state assumptions about <em>initial</em> state of ecosystem properties like temperature
water, snow, ice, carbon &amp; nitrogen.  This is the <em>equilibrium</em> state of the model, given the forcing
data. In model experiments  we make modifications to namelist settings, the parameter files, surface dataset, or underlying model code we also need to generate new initial conditions.</p>
<p>In runs with active biogoechemistry, like these NEON simulations, this means we need to get the ecosystem carbon and nigrogen pools with long turnover times into steady state. The turnover and decomposition of these slow pools is mathamatically accelerated in our AD (accelerated decomposition) case.  This means we:</p>
<ul class="simple">
<li><p>Accelerate turnover of wood, litter and soil pools.</p></li>
<li><p>Accelerate advection and diffusion terms too</p></li>
<li><p>In CLM5 and CTSM5.1 this is calculated as a function of latitude so that spinup is more accelerated in high latitude regions.</p></li>
</ul>
<p>Spinning up CTSM consists of 3 parts that includes:</p>
<ol class="arabic simple">
<li><p>ad, for accelerated decomposition,</p></li>
<li><p>postAD, which occurs after ad spinup, and</p></li>
<li><p>transient.</p></li>
</ol>
<p>More information about spinup is available in the <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/master/html/users_guide/running-special-cases/Spinning-up-the-biogeochemistry-BGC-spinup.html?highlight=spinup">CLM user’s guide</a>.  Briefly:</p>
<ul class="simple">
<li><p>During ad and postAD spinup, we just cycle over several years of input data.  For most NEON sites we cycle over four years of data from 2018-2021.  This also is the same time period we have data for running transient simulations, but as the NEON record gets longer, so too will these transient simulations.</p></li>
<li><p>During ad and postAD spinup we hold other inputs constant (e.g., atmospheric CO2 concentrations, N deposition, etc.).  For transient runs these inputs also change over time.</p></li>
<li><p>During ad spinup we accelerated the turnover of <em>slow</em> pools of C and N that normally have a long residence time in ecosystems (wood and soils).</p></li>
<li><p>During postAD runs we take away this accelerated decomposition and let the ecosystem settle into its equilibrium, or steady-state under ‘normal conditions’.</p></li>
<li><p>Finally, transient runs are used to compare with observations, and include high frequency output that we can compare with flux tower measurements.</p></li>
</ul>
<div class="alert alert-block alert-info">
<p><b>NOTE:</b> for runs without active biogeochemistry (called satelite shenology, or SP simulations), we still need to equilibrate the model. This is much faster and doesn’t require accelerated decomposition.</p>
</div><p>For most temperate systems &lt; 200 years of AD simulations seems adequate, but in colder ecosystems (like NEON sites in Alaska) this can take much longer because cold temperatures slow the turnover of soil organic matter.  We have this set up already in the usermod directories that are used to configure your NEON case with <code class="docutils literal notranslate"><span class="pre">run_neon</span></code>. We can look to see if total ecosystem carbon pools (the sum of all vegetation, litter and soil C stocks) look to be equilibrated after 200 years.</p>
<p><img alt="ad_spinup" src="../../_images/WOOD.BTRAN.ad_spin.png" /></p>
<section id="look">
<h2>LOOK<a class="headerlink" href="#look" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Does the model seem to have achieved steady state?</p></li>
<li><p>Why are there periodic oscillations in the total ecosystem C pools?</p></li>
</ul>
<p>This plot was generated using the <a class="reference internal" href="QuickPlot_CTSM_spinup.html"><span class="doc std std-doc">QuickPlot_CTSM_spinup</span></a> notebook, which you can modify for your own site or simulation.</p>
<p>After your AD simulation is finished, we have to take the model out of AD mode.  We call these postAD simulations.</p>
<p>Have a look to see if 100 years is enough to get pools to steady state?</p>
<p><img alt="postad" src="../../_images/WOOD.BTRAN.postad.png" /></p>
</section>
<section id="id1">
<h2>LOOK<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>In postad simulations ecosystem carbon and nitrogen are much larger than in the ad case.</p></li>
<li><p>Does the model seem to have achieved steady state?</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="let-s-get-started">
<h2>Let’s get started!<a class="headerlink" href="#let-s-get-started" title="Permalink to this heading">#</a></h2>
<div class="alert alert-block alert-warning">
<p><b>NOTICE:</b> If you’re running this notebook through the NCAR JupyterHub login, you need to be on a Cheyenne login node (NOT Casper).</p>
</div>
<hr class="docutils" />
<section id="set-up-environment">
<h3>Set up environment<a class="headerlink" href="#set-up-environment" title="Permalink to this heading">#</a></h3>
<p>It is important in order to have all the tools and packages you need to run simulations.</p>
<div class="alert alert-block alert-info">
<p><b>TIP:</b> <i>If you’re running on Cheyenne</i>, you may need to uncomment the the following two lines of code. This will set up your conda environment correctly.</p>
<p><b>This is not required if your running CESM-Lab in the cloud.</b></p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#module purge</span>
<span class="c1">#module load conda ncarenv</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="create-a-new-ad-case">
<h1>1. Create a new ad case.<a class="headerlink" href="#create-a-new-ad-case" title="Permalink to this heading">#</a></h1>
<p>Because we’re going to modify namelist options that will change answers in CLM we have to run this case through an accelerated decompostion (AD) and postAD spinup.  This will generate new initial conditions for our experimental case, but it also takes a long time.</p>
<section id="check-that-you-ve-run-a-control-case">
<h2>1.1 Check that you’ve run a control case.<a class="headerlink" href="#check-that-you-ve-run-a-control-case" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">neon_site</span><span class="o">=</span><span class="s1">&#39;HARV&#39;</span><span class="w">            </span><span class="c1"># the site you want to run</span>
ls<span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.transient
</pre></div>
</div>
</div>
</div>
<p>If the code block above says <em>“No such file or directory”</em> you need to go back and create a control case for your neon_site using <a class="reference internal" href="Clone_Case.html"><span class="doc std std-doc">clone_case</span></a>.</p>
<p>If you have run a control case, which includes flies like:</p>
<ul class="simple">
<li><p>case.build, case.setup, and case.submit;</p></li>
<li><p>env_build.xml, env_batch.xml, and env_run.xml; and</p></li>
<li><p>user_nl_clm, user_nl_datm, and user_nl_datm_streams</p></li>
</ul>
<p>Then you can move on to the next step</p>
</section>
<section id="navigate-to-your-source-code">
<h2>1.2 Navigate to your source code<a class="headerlink" href="#navigate-to-your-source-code" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/CTSM/tools/site_and_regional
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-an-experimental-clone">
<h2>1.3 Create an experimental clone<a class="headerlink" href="#create-an-experimental-clone" title="Permalink to this heading">#</a></h2>
<p>In our experimental case we’ll changing the foliar C:N ratio for a temperate deciduous tree.</p>
<div class="alert alert-block alert-info">
<p><b>HINT:</b> It’s helpful to have descriptive experiment names.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">experiment</span><span class="o">=</span><span class="s1">&#39;foliarCN-30&#39;</span><span class="w">    </span><span class="c1"># this is name of your experimenal case </span>
</pre></div>
</div>
</div>
</div>
<p>Since we’re creating an experimental case that will change answers in the model we should run a full AD and postAD spinup. The same run_neon script makes this simple.</p>
<p>Then run_neon with the following flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--experiment</span> <span class="pre">$experiment</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--run-type</span> <span class="pre">ad</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--setup-only</span></code></p></li>
</ul>
<p><strong>NOTE</strong> Don’t worry about build warnings from the list below, we’ll build the model later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run_neon.py<span class="w"> </span>--neon-sites<span class="w"> </span><span class="nv">$neon_site</span><span class="w">  </span><span class="se">\</span>
<span class="w">   </span>--output-root<span class="w"> </span>~/scratch/NEON_cases<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--experiment<span class="w"> </span><span class="nv">$experiment</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--run-type<span class="w"> </span>ad<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--overwrite<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--setup-only<span class="w">  </span>
<span class="w">   </span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;----Your experiment.ad case has been created----&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="customizing-your-case-namelist-changes">
<h2>1.4 Customizing your case: Namelist changes<a class="headerlink" href="#customizing-your-case-namelist-changes" title="Permalink to this heading">#</a></h2>
<p>The configuration of CLM can be customized via namelist modifications.</p>
<p>These changes made using namelist files like <code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code></p>
<section id="move-to-the-case-directory-for-your-experimental-clone">
<h3>1.4.1 Move to the case directory for your experimental clone<a class="headerlink" href="#move-to-the-case-directory-for-your-experimental-clone" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.ad
</pre></div>
</div>
</div>
</div>
</section>
<section id="customize-your-case">
<h3>1.4.2 Customize your case<a class="headerlink" href="#customize-your-case" title="Permalink to this heading">#</a></h3>
<p>For this experiment we’re changing the foliar C:N ratio for temperate deciduous forests.  Do do this we have to point to our modified parameter file. We can change user_nl_clm using an editor, by opening it directly in jupyter hub, or with the following command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the path to the modified parameter file you created</span>

<span class="c1"># If you&#39;re running on cheyenne, uncomment the line below</span>
<span class="c1">#echo &quot;paramfile = &#39;/glade/scratch/$USER/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot; &gt;&gt; user_nl_clm</span>

<span class="c1"># If you&#39;re running with CESM-Lab in the cloud, uncomment the line below</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;paramfile = &#39;/scratch/</span><span class="nv">$USER</span><span class="s2">/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>user_nl_clm
</pre></div>
</div>
</div>
</div>
<p>Let make sure this worked.  We can:</p>
<ul class="simple">
<li><p>preview namelists;</p></li>
<li><p>check the  <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> file.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./preview_namelists
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>CaseDocs/lnd_in<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-50
</pre></div>
</div>
</div>
</div>
<p>There’s a lot to dig into here! So we’ll just stick with a few highlights.</p>
<section id="take-a-look">
<h4>Take a look<a class="headerlink" href="#take-a-look" title="Permalink to this heading">#</a></h4>
<p><strong>See what printed to in the cell above and answer the following questions</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">finidat</span></code>: What initial conditions file are you using?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsurdat</span></code>: What surface dataset are you using?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramfile</span></code>: What parameter file are you using?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spinup_state</span></code>: What is your spinup state?</p></li>
</ul>
<p>Does this make sense?  Answers are in the hidden cell below.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">finidat</span> <span class="pre">=</span> <span class="pre">'</span> <span class="pre">'</span></code>  None!  we’re starting from a coldstart.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsurdat</span> <span class="pre">=</span> <span class="pre">&quot;.../surfdata_1x1_NEON_HARV_hist_78pfts_CMIP6_simyr2000_c230111.nc&quot;</span></code> This the surface dataset that’s been modified for our NEON site.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramfile</span> <span class="pre">=</span> <span class="pre">'.../ctsm51_params.c211112_tdf_leafcn30.nc'</span></code> is our modified parameter file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spinup_state</span> <span class="pre">=</span> <span class="pre">2</span></code>, which is used for ad mode</p></li>
</ul>
<hr class="docutils" />
<ul class="simple">
<li><p>Additional information about customizing CTSM’s configurations, including namelist modifications, are available in the <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/master/html/users_guide/setting-up-and-running-a-case/customizing-the-clm-configuration.html?highlight=namelist">CTSM users guide</a>
Namelist changes can also be used to modify variables on history file output. Simple modification of history file output DOES NOT require spinning up the model.</p></li>
<li><p>A list of all the <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/master/html/users_guide/setting-up-and-running-a-case/master_list_nofates.html">CTSM history fields are available here</a></p></li>
<li><p>A list of all the <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/master/html/users_guide/setting-up-and-running-a-case/master_list_fates.html">CTSM-FATES history fields are available here</a></p></li>
</ul>
</section>
</section>
<section id="setup-build-and-submit-the-case">
<h3>1.5 setup, build, and submit the case<a class="headerlink" href="#setup-build-and-submit-the-case" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.setup
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qcmd<span class="w"> </span>--<span class="w"> </span>./case.build
</pre></div>
</div>
</div>
</div>
<p>If you get a notice that <code class="docutils literal notranslate"><span class="pre">MODEL</span> <span class="pre">BUILD</span> <span class="pre">HAS</span> <span class="pre">FINISHED</span> <span class="pre">SUCCESSFULLY</span></code>, submit your case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.submit
</pre></div>
</div>
</div>
</div>
<div class="alert alert-warning">
<strong>STOP!</strong> 
<p>Running an AD spinup for 200 model years will take a few hours of wall clock time.</p>
<p>Don’t move on with this tutorial until after the AD simulation is completed.</p>
</div>
<p>After your simulation is finised you can check results with the <a class="reference internal" href="QuickPlot_CTSM_spinup.html"><span class="doc std std-doc">QuickPlot_CTSM_spinup notebook</span></a>.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="postad-simulations">
<h1>2 postAD simulations<a class="headerlink" href="#postad-simulations" title="Permalink to this heading">#</a></h1>
<p>After the model has reached steady-state we have to take it out of AD mode, which requires another ~100 years of simulations.  We also have to create and build a new base case for postAD runs.</p>
<section id="be-sure-your-ad-case-is-finished">
<h2>2.1 Be sure your AD case is finished.<a class="headerlink" href="#be-sure-your-ad-case-is-finished" title="Permalink to this heading">#</a></h2>
<p><strong>HINT</strong> If the cell below fails, you may need to set environmental variables for <code class="docutils literal notranslate"><span class="pre">$neon_site</span></code> and <code class="docutils literal notranslate"><span class="pre">$experiment</span></code> again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.ad/CaseStatus<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-10
</pre></div>
</div>
</div>
</div>
<p>The last line of your AD CaseStatus file should read <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">st_archive</span> <span class="pre">success</span> <span class="pre">...</span></code></p>
<p><strong>If this isn’t true, your case may still be running, or it may have failed</strong></p>
<ul class="simple">
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-u</span> <span class="pre">$USER</span></code>, also</p></li>
<li><p>Look an the <code class="docutils literal notranslate"><span class="pre">lnd.log.*</span></code> and <code class="docutils literal notranslate"><span class="pre">cesm.log.*</span></code> files in your case/run directory (<code class="docutils literal notranslate"><span class="pre">~/scratch/NEON_cases/$neon_site.$experiment.ad/run</span></code>)</p></li>
</ul>
<section id="if-your-ad-run-is-completed-you-can-move-on">
<h3>IF YOUR AD RUN IS COMPLETED, YOU CAN MOVE ON<a class="headerlink" href="#if-your-ad-run-is-completed-you-can-move-on" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="id2">
<h2>2.2 Navigate to your source code<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/CTSM/tools/site_and_regional
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-postad-experimental-case">
<h2>2.3 Create a postAD experimental case<a class="headerlink" href="#create-a-postad-experimental-case" title="Permalink to this heading">#</a></h2>
<p>Now we’re using a different <code class="docutils literal notranslate"><span class="pre">--run-type</span></code> that’s appropriate for the case.</p>
<p>As before, you’ll get warning related to the the model build.  This is OK, we’ll built our case later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run_neon.py<span class="w"> </span>--neon-sites<span class="w"> </span><span class="nv">$neon_site</span><span class="w">  </span><span class="se">\</span>
<span class="w">   </span>--output-root<span class="w"> </span>~/scratch/NEON_cases<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--experiment<span class="w"> </span><span class="nv">$experiment</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--run-type<span class="w"> </span>postad<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--overwrite<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--setup-only<span class="w"> </span>

<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;----Your experiment.postad case has been created----&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>2.4 Customize your case<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>This should follow namelist, xml, or other changes you made in the ad run, section 1.4, above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.postad
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the path to the modified parameter file you created</span>

<span class="c1"># If you&#39;re running on cheyenne, uncomment the line below</span>
<span class="c1">#echo &quot;paramfile = &#39;/glade/scratch/$USER/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot; &gt;&gt; user_nl_clm</span>

<span class="c1"># If you&#39;re running with CESM-Lab in the cloud, uncomment the line below</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;paramfile = &#39;/scratch/</span><span class="nv">$USER</span><span class="s2">/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>user_nl_clm
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./preview_namelists
</pre></div>
</div>
</div>
</div>
<p><strong>Stop and check!</strong></p>
<ul class="simple">
<li><p>How are the <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> files different in our ad and postad cases?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diff<span class="w"> </span>CaseDocs/lnd_in<span class="w"> </span>../<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.ad/CaseDocs/lnd_in
</pre></div>
</div>
</div>
</div>
<p>the postad case has:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">finidat</span> <span class="pre">=</span> <span class="pre">'HARV.foliarCN-30.ad...'</span></code> initial conditions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spinup_state</span> <span class="pre">=</span> <span class="pre">0</span></code> meaning we’re out of ad mode now</p></li>
<li><p>different builds</p></li>
</ul>
<section id="id4">
<h3>2.5 setup, build, and submit the case<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.setup
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qcmd<span class="w"> </span>--<span class="w"> </span>./case.build
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.submit
</pre></div>
</div>
</div>
</div>
<div class="alert alert-warning">
<strong>STOP!</strong> 
<p>Running an postAD run for 100 model years will also take about an hour of wall clock time.</p>
<p>Don’t move on with this tutorial until after the post simulation is completed.</p>
</div>
<p>After your simulation is finised you can check postAD results with the <a class="reference internal" href="QuickPlot_CTSM_spinup.html"><span class="doc std std-doc">QuickPlot_CTSM_spinup notebook</span></a>.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="transient-simulation">
<h1>3 Transient simulation<a class="headerlink" href="#transient-simulation" title="Permalink to this heading">#</a></h1>
<p>Now we’re finally ready to go ahead with the transient simulation</p>
<section id="be-sure-your-postad-case-is-finished">
<h2>3.1 Be sure your postAD case is finished.<a class="headerlink" href="#be-sure-your-postad-case-is-finished" title="Permalink to this heading">#</a></h2>
<p><strong>HINT</strong> If the cell below fails, you may need to set environmental variables for <code class="docutils literal notranslate"><span class="pre">$neon_site</span></code> and <code class="docutils literal notranslate"><span class="pre">$experiment</span></code> again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.postad/CaseStatus<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-10
</pre></div>
</div>
</div>
</div>
<p>The last line of your postad CaseStatus file should read <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">st_archive</span> <span class="pre">success</span> <span class="pre">...</span></code></p>
<p><strong>If this isn’t true, your case may still be running, or it may have failed</strong></p>
<ul class="simple">
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-u</span> <span class="pre">$USER</span></code>, also</p></li>
<li><p>Look an the <code class="docutils literal notranslate"><span class="pre">lnd.log.*</span></code> and <code class="docutils literal notranslate"><span class="pre">cesm.log.*</span></code> files in your case/run directory (<code class="docutils literal notranslate"><span class="pre">~/scratch/NEON_cases/$neon_site.$experiment.postad/run</span></code>)</p></li>
</ul>
<section id="if-your-postad-run-is-completed-you-can-move-on">
<h3>IF YOUR POSTAD RUN IS COMPLETED, YOU CAN MOVE ON<a class="headerlink" href="#if-your-postad-run-is-completed-you-can-move-on" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="id5">
<h2>3.2 Navigate to your source code<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/CTSM/tools/site_and_regional
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-transient-experimental-case">
<h2>3.3 Create a transient experimental case<a class="headerlink" href="#create-a-transient-experimental-case" title="Permalink to this heading">#</a></h2>
<p>Now we’re using:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--run-type</span> <span class="pre">transient</span></code> that’s appropriate for the case and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--run-from-postad</span></code> that will grab initial conditions from our postAD experimental case.</p></li>
</ul>
<p>To avoid confusion, we won’t run this from a base_case, athough it does mean we have to build the transient case again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run_neon.py<span class="w"> </span>--neon-sites<span class="w"> </span><span class="nv">$neon_site</span><span class="w">  </span><span class="se">\</span>
<span class="w">   </span>--output-root<span class="w"> </span>~/scratch/NEON_cases<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--experiment<span class="w"> </span><span class="nv">$experiment</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--run-type<span class="w"> </span>transient<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--overwrite<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--setup-only<span class="w">  </span><span class="se">\</span>
<span class="w">   </span>--run-from-postad
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h2>3.4 Customize your case<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>This should follow namelist, xml, or other changes you made in the ad run, sections 1.4 and 2.4, above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.transient
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the path to the modified parameter file you created</span>

<span class="c1"># If you&#39;re running on cheyenne, uncomment the line below</span>
<span class="c1">#echo &quot;paramfile = &#39;/glade/scratch/$USER/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot; &gt;&gt; user_nl_clm</span>

<span class="c1"># If you&#39;re running with CESM-Lab in the cloud, uncomment the line below</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;paramfile = &#39;/scratch/</span><span class="nv">$USER</span><span class="s2">/NEON_cases/modified_inputs/ctsm51_params.c211112_tdf_leafcn30.nc&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>user_nl_clmcd<span class="w"> </span>~/scratch/NEON_cases/<span class="nv">$new_case</span>.<span class="nv">$experiment</span>.transient
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./preview_namelists
</pre></div>
</div>
</div>
</div>
<p><strong>Stop and check!</strong></p>
<ul class="simple">
<li><p>How are the <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> files different in our postAD and transient cases?</p></li>
<li><p>Do these differences make sense?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diff<span class="w"> </span>CaseDocs/lnd_in<span class="w"> </span>../<span class="nv">$neon_site</span>.<span class="nv">$experiment</span>.postad/CaseDocs/lnd_in
</pre></div>
</div>
</div>
</div>
<section id="double-check">
<h3>Double check<a class="headerlink" href="#double-check" title="Permalink to this heading">#</a></h3>
<p>It’s a good idea to make sure cases have expected differences.</p>
<p>See if this is true for our control and experimental transient cases.</p>
<ul class="simple">
<li><p>How are the <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> files different in our control and experimental cases?</p></li>
<li><p>Do these differences make sense?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diff<span class="w"> </span>CaseDocs/lnd_in<span class="w"> </span>../<span class="nv">$neon_site</span>.transient/CaseDocs/lnd_in
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h3>3.5 setup, build, and submit the case<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.setup
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qcmd<span class="w"> </span>--<span class="w"> </span>./case.build
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./case.submit
</pre></div>
</div>
</div>
</div>
<div class="alert alert-success">
<strong>Congratulations!</strong> 
<p>You’ve created and run a full spinup for an experimental case of CLM at the NEON tower you selected!</p>
<p>Now we need to see how the simulations are different.</p>
</div>
<p>If you’re developing this tutorial:
Before saving and pushing this code to github go to <code class="docutils literal notranslate"><span class="pre">Kernel</span></code> and <code class="docutils literal notranslate"><span class="pre">Restart</span> <span class="pre">kernel</span> <span class="pre">and</span> <span class="pre">clear</span> <span class="pre">all</span> <span class="pre">outputs...</span></code></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "bash"
        },
        kernelOptions: {
            name: "bash",
            path: "./notebooks/ProjectExamples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'bash'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Customize your case: Spinning up the model</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-tutorial-you-will-use-run-neon-to">In this tutorial you will use run_neon to:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#background-on-spinup">Background on spinup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#look">LOOK</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">LOOK</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-get-started">Let’s get started!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-environment">Set up environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-ad-case">1. Create a new ad case.</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-that-you-ve-run-a-control-case">1.1 Check that you’ve run a control case.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#navigate-to-your-source-code">1.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-experimental-clone">1.3 Create an experimental clone</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-your-case-namelist-changes">1.4 Customizing your case: Namelist changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#move-to-the-case-directory-for-your-experimental-clone">1.4.1 Move to the case directory for your experimental clone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customize-your-case">1.4.2 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#take-a-look">Take a look</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-build-and-submit-the-case">1.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#postad-simulations">2 postAD simulations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-sure-your-ad-case-is-finished">2.1 Be sure your AD case is finished.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-your-ad-run-is-completed-you-can-move-on">IF YOUR AD RUN IS COMPLETED, YOU CAN MOVE ON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-postad-experimental-case">2.3 Create a postAD experimental case</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.4 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transient-simulation">3 Transient simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#be-sure-your-postad-case-is-finished">3.1 Be sure your postAD case is finished.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-your-postad-run-is-completed-you-can-move-on">IF YOUR POSTAD RUN IS COMPLETED, YOU CAN MOVE ON</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">3.2 Navigate to your source code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-transient-experimental-case">3.3 Create a transient experimental case</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">3.4 Customize your case</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-check">Double check</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.5 setup, build, and submit the case</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Negin Sobhani, Danica Lombardozzi, Adrianna Foster, Will Wieder, Teagan King
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>